---
title: Mensagens, payloads e serialização do Barramento de Serviço do Azure | Microsoft Docs
description: Visão geral dos payloads de mensagem do Barramento de Serviço
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/26/2018
ms.author: aschhab
ms.openlocfilehash: 3158f0255810c66605d28856133112181c2916db
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "61315632"
---
# <a name="messages-payloads-and-serialization"></a>Mensagens, payloads e serialização

O Barramento de Serviço do Microsoft Azure lida com mensagens. As mensagens carregam um payload, assim como metadados, na forma de propriedades de par chave-valor, descrevendo o payload e oferecendo instruções de tratamento para o Barramento de Serviço e para aplicativos. Ocasionalmente, esses metadados sozinhos são suficientes para carregar as informações que o remetente deseja comunicar aos destinatários e o payload permanece vazio.

O modelo de objeto dos clientes oficiais do Barramento de Serviço para .NET e Java reflete a estrutura de mensagem do Barramento de Serviço abstrato, que é mapeada para e dos protocolos de transmissão compatíveis com o Barramento de Serviço.
 
Uma mensagem do Barramento de Serviço consiste em uma seção de payload binário que o Barramento de Serviço nunca manipula em nenhuma forma no lado do serviço e dois conjuntos de propriedade. As *propriedades do agente* são predefinidas pelo sistema. Essas propriedades predefinidas controlam a funcionalidade de nível de mensagem dentro do agente ou são mapeados para os itens de metadados comuns e padronizados. As *propriedades do usuário* são uma coleção de pares chave-valor que podem ser definidas pelo aplicativo.
 
As propriedades do agente predefinidas são listadas na tabela a seguir. Os nomes são usados com todas as APIs oficiais do cliente e também no objeto JSON [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) do mapeamento do protocolo HTTP.
 
Os nomes equivalentes usados no nível do protocolo AMQP estão listados entre parênteses. 

| Nome da Propriedade                         | DESCRIÇÃO                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (content-type)           | Descreve opcionalmente o payload da mensagem com um descritor seguindo o formato de RFC2045, Seção 5; por exemplo, `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (correlation-id)       | Permite que um aplicativo especifique um contexto para a mensagem para fins de correlação; por exemplo, refletindo o **MessageId** de uma mensagem que está sendo respondida.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Definido apenas em mensagens mortas e subsequentemente encaminhadas automaticamente da fila de mensagens mortas para outra entidade. Indica a entidade na qual a mensagem foi morta. Essa propriedade é somente leitura.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Número de entregas que foram tentadas para essa mensagem. A contagem é incrementada quando um bloqueio de mensagem expira ou quando a mensagem é explicitamente abandonada pelo destinatário. Essa propriedade é somente leitura.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Para mensagens que foram encaminhadas automaticamente, essa propriedade reflete o número de sequência que tinha sido atribuído primeiro à mensagem em seu ponto de envio original. Essa propriedade é somente leitura.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | O instante do UTC no qual a mensagem foi aceita e armazenada na entidade. Esse valor pode ser usado como um indicador de tempo de chegada autoritativo e neutro quando o receptor não deseja confiar relógio do remetente. Essa propriedade é somente leitura.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolute-expiry-time) | O instante do UTC em que a mensagem é marcada para remoção e não está mais disponível para recuperação da entidade devido à sua expiração. A expiração é controlada pela propriedade **TimeToLive** e essa propriedade é computada em EnqueuedTimeUtc+TimeToLive. Essa propriedade é somente leitura.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Para filas ou tópicos que têm o sinalizador [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) definido, essa propriedade pode ser definida para indicar que a mensagem deve ser preservada no disco antes de ser confirmada. Esse é o comportamento padrão para todas as entidades não expressas.                                                                                                                                                                                                         |
| [Label](/dotnet/api/microsoft.azure.servicebus.message.label) (assunto)                       | Essa propriedade permite que o aplicativo indique a finalidade da mensagem para o destinatário de maneira padronizada, semelhante a uma linha do assunto de email.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Para mensagens recuperadas com um bloqueio (modo de recebimento de bloqueio de pico, não previamente liquidadas) esta propriedade reflete o instante do UTC até que a mensagem seja mantida bloqueada na fila/assinatura. Quando o bloqueio expirar, o [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) será incrementado e a mensagem estará disponível novamente para recuperação. Essa propriedade é somente leitura.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | O token de bloqueio é uma referência para o bloqueio que está sendo mantido pelo agente no modo de recebimento de *bloqueio de pico*. O token pode ser usado para fixar o bloqueio permanentemente por meio da API de [adiamento](message-deferral.md) e, com isso, tirar a mensagem fora do fluxo do estado de entrega regular. Essa propriedade é somente leitura.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (message-id)                | O identificador da mensagem é um valor definido pelo aplicativo que identifica exclusivamente a mensagem e seu payload. O identificador é uma cadeia de caracteres de forma livre e pode refletir um GUID ou um identificador derivado do contexto do aplicativo. Se habilitado, o recurso [detecção de duplicidades](duplicate-detection.md) identifica e remove a segunda e os envios adicionais de mensagens com o mesmo **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Para [entidades particionadas](service-bus-partitioning.md), definir esse valor permite a atribuição de mensagens relacionadas à mesma partição interna para que a ordem de sequência de envio esteja registrada corretamente. A partição é escolhida por uma função de hash sobre esse valor e não pode ser escolhida diretamente. Para entidades com reconhecimento de sessão, a propriedade **SessionId** substitui esse valor.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (reply-to)                    | Esse valor opcional e definido pelo aplicativo é uma maneira padrão de expressar um caminho de resposta para o receptor da mensagem. Quando um remetente espera uma resposta, ele define o valor como o caminho absoluto ou relativo da fila ou do tópico para o qual ele espera que a resposta seja enviada.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-to-group-id)  | Esse valor aumenta a informação **ReplyTo** e especifica qual **SessionId** deve ser definido para a resposta quando enviada para a entidade de resposta.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Para mensagens disponibilizadas apenas para recuperação após um atraso, essa propriedade define o instante do UTC no qual a mensagem será logicamente enfileirada, sequenciada e, portanto, disponibilizada para recuperação.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | O número de sequência é um inteiro de 64 bits atribuído a uma mensagem conforme ela é aceita e armazenada pelo agente e por funções como seu identificador verdadeiro. Para entidades particionadas, os 16 bits de nível mais alto refletem o identificador da partição. Os números de sequência aumentam de forma monotônica e não têm intervalo. Eles passam para 0 quando o intervalo de 48 a 64 bits é esgotado. Essa propriedade é somente leitura.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (group-id)                  | Para entidades com reconhecimento de sessão, esse valor definido pelo aplicativo especifica a afiliação de sessão da mensagem. As mensagens com o mesmo identificador de sessão estão sujeitas ao bloqueio de resumo e permitem a demultiplexação e o processamento na ordem exata. Para entidades que não estejam cientes de sessão, esse valor é ignorado.                                                                                                                                     |
| [Tamanho](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Reflete o tamanho armazenado da mensagem no log do agente como uma contagem de bytes, uma vez que ele contribui com a cota de armazenamento. Essa propriedade é somente leitura.                                                                                                                                                                                                                                                                                                       |
| [State](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Indica o estado da mensagem no log. Essa propriedade só é relevante durante a pesquisa de mensagens (“pico”), para determinar se a mensagem está “ativa” e disponível para recuperação assim que ela atingir o topo da fila, se ela é adiada ou se está esperando para ser agendada. Essa propriedade é somente leitura.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Esse valor é a duração relativa após a qual a mensagem expira, a partir do momento em que a mensagem foi aceita e armazenada pelo agente, conforme capturada em **EnqueueTimeUtc**. Quando não definido explicitamente, o valor assumido será o **DefaultTimeToLive** para a respectiva fila ou tópico. Um valor **TimeToLive** no nível da mensagem não pode ser maior do que a configuração **DefaultTimeToLive** da entidade. Se ele for maior, é ajustado silenciosamente. |
| [To](/dotnet/api/microsoft.azure.servicebus.message.to) (to)                               | Essa propriedade é reservada para uso futuro em cenários de roteamento e é atualmente ignorada pelo próprio agente. Os aplicativos podem usar esse valor em cenários de encadeamento de encaminhamento automático orientado à regra para indicar o destino lógico pretendido da mensagem.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Se uma mensagem é enviada por meio de uma fila de transferência no escopo de uma transação, esse valor seleciona a partição da fila de transferência.                                                                                                                                                                                                                                                                                                                 |

O modelo de mensagem abstrata permite que uma mensagem seja postada em uma fila por meio de HTTP (sempre HTTPS, na verdade) e possa ser recuperada por meio do AMQP. Em qualquer caso, a mensagem parece normal no contexto do respectivo protocolo. As propriedades do agente são convertidas conforme necessário e as propriedades do usuário são mapeadas para o local mais adequado no respectivo modelo de mensagem de protocolo. Em HTTP, as propriedades do usuário são mapeadas diretamente para os cabeçalhos HTTP e deles; em AMQP, elas são mapeadas para o mapa **propriedades do aplicativo** e dele.

## <a name="message-routing-and-correlation"></a>Roteamento e correlação de mensagens

Um subconjunto das propriedades do agente descritas anteriormente, especificamente [To](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid) e [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), são usadas para ajudar os aplicativos a rotear mensagens para destinos específicos. Para ilustrar isso, considere alguns padrões:

- **Solicitação/resposta simples**: um editor envia uma mensagem em uma fila e espera uma resposta do consumidor da mensagem. Para receber a resposta, o editor tem uma fila para a qual ele espera que as respostas sejam entregues. O endereço dessa fila é expresso na propriedade **ReplyTo** da mensagem de saída. Quando o consumidor responde, ele copia o **MessageId** da mensagem tratada para a propriedade **CorrelationId** da mensagem de resposta e entrega a mensagem ao destino indicado pela propriedade **ReplyTo**. Uma mensagem pode render várias respostas, dependendo do contexto do aplicativo.
- **Solicitação/resposta multicast**: como uma variação do padrão anterior, um editor envia a mensagem em um tópico e vários assinantes se tornam elegíveis para consumi-la. Cada um dos assinantes pode responder da maneira descrita anteriormente. Esse padrão é usado em cenários de descoberta ou de chamada de rolagem, e o participante normalmente identifica-se com uma propriedade de usuário ou dentro do payload. Se **ReplyTo** aponta para um tópico, esse conjunto de respostas de descoberta pode ser distribuído para um público-alvo.
- **Multiplexação**: este recurso de sessão permite a multiplexação de fluxos de mensagens relacionadas por meio de uma única fila ou da assinatura de modo que cada sessão (ou grupo) de mensagens relacionadas, identificadas pelos valores **SessionId** correspondentes, seja roteada para um destinatário específico enquanto o receptor mantém a sessão bloqueada. Leia mais sobre os detalhes das sessões [aqui](message-sessions.md).
- **Solicitação/resposta multiplexada**: este recurso de sessão permite respostas multiplexadas, possibilitando que vários editores compartilhem uma fila de resposta. Ao definir **ReplyToSessionId**, editor pode instruir os consumidores a copiar esse valor para a propriedade **SessionId** da mensagem de resposta. A fila ou tópico de publicação não precisa ter reconhecimento de sessão. Assim que a mensagem é enviada, o editor pode aguardar especificamente uma sessão com o **SessionId** fornecido ser materializada na fila aceitando condicionalmente um receptor de sessão. 

O roteamento dentro de um namespace do Barramento de Serviço pode ser obtido usando as regras de encadeamento de encaminhamento automático e de assinatura de tópico. O roteamento entre namespaces pode ser obtido [usando o Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Conforme indicado na lista anterior, a propriedade **To** é reservada para uso futuro e pode, eventualmente, ser interpretada pelo agente com um recurso especialmente habilitado. Os aplicativos que desejarem implementar o roteamento deverão fazer isso com base nas propriedades do usuário e não depender da propriedade **To**; no entanto, fazer isso não causará problemas de compatibilidade.

## <a name="payload-serialization"></a>Serialização de payload

Quando estiver em trânsito ou armazenado dentro do Barramento de Serviço, o payload é sempre um bloco opaco e binário. A propriedade [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) permite que os aplicativos descrevam o payload com o formato sugerido para os valores de propriedade, sendo uma descrição de tipo de conteúdo MIME de acordo com a IETF RFC2045; por exemplo, `application/json;charset=utf-8`.

Diferentemente das variantes Java ou .NET Standard, a versão .NET Framework da API do Barramento de Serviço dá suporte à criação de instâncias **BrokeredMessage** passando objetos .NET arbitrários para o construtor. 

Ao usar o protocolo SBMP herdado, esses objetos são serializados com o serializador binário padrão ou com um serializador fornecido externamente. Ao usar o protocolo AMQP, o objeto é serializado em um objeto AMQP. O receptor pode recuperar esses objetos com o método [GetBody<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1), fornecendo o tipo esperado. Com AMQP, os objetos são serializados em um gráfico AMQP dos objetos **ArrayList** e **IDictionary <string,object>**, e qualquer cliente do AMQP pode decodificá-los. 

Embora essa mágica de serialização oculta seja conveniente, os aplicativos devem assumir o controle explícito da serialização do objeto e transformar os grafos dos seus objetos em fluxos antes de incluí-los em uma mensagem e fazer o contrário no lado do receptor. Isso produz resultados interoperáveis. Também deve-se observar que, embora o AMQP tenha um avançado modelo de codificação binária, ele está vinculado ao ecossistema de mensagens AMQP e os clientes HTTP terão problemas para decodificar esses payloads. 

Geralmente, recomendamos JSON e Apache Avro como formatos de payload para dados estruturados.

As variantes de .NET Standard e Java API só aceitam matrizes de bytes, o que significa que o aplicativo deve lidar com o controle de serialização do objeto. 

## <a name="next-steps"></a>Próximas etapas

Para saber mais sobre as mensagens do Barramento de Serviço, consulte os seguintes tópicos:

* [Filas, tópicos e assinaturas do Barramento de Serviço](service-bus-queues-topics-subscriptions.md)
* [Introdução às filas do Barramento de Serviço](service-bus-dotnet-get-started-with-queues.md)
* [Como usar tópicos e assinaturas do Barramento de Serviço](service-bus-dotnet-how-to-use-topics-subscriptions.md)
