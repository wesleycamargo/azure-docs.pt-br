<properties
   pageTitle="Lista de verificação de disponibilidade | Microsoft Azure"
   description="Lista de verificação que fornece orientação para questões de disponibilidade durante a criação."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="masimms"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/01/2016"
   ms.author="masashin"/>

# Lista de verificação de disponibilidade

![](media/best-practices-availability-checklist/pnp-logo.png)

## Design do aplicativo

- **Evite quaisquer pontos únicos de falha.** Todos os componentes, serviços, recursos e instâncias de computação devem ser implantados como várias instâncias para impedir que um ponto único de falha afete a disponibilidade. Isso inclui os mecanismos de autenticação. Projete o aplicativo de modo que ele seja configurável, para usar várias instâncias e para, automaticamente, detectar falhas e redirecionar solicitações para instâncias sem falha sempre que a plataforma não fizer isso automaticamente.
- **Decomponha a carga de trabalho de acordo com o contrato de nível de serviço.** Se um serviço for composto por cargas de trabalho críticas e outras menos críticas, gerencie-as de maneira diferente e especifique os recursos de serviço e o número de instâncias para atender aos requisitos de disponibilidade dessas cargas de trabalho.
- **Minimize e entenda as dependências de serviço.** Minimize o número de serviços diferentes usados sempre que possível e certifique-se de compreender todas as dependências de recurso e de serviço que existem no sistema. Isso inclui a natureza dessas dependências e o impacto da falha ou redução do desempenho em cada uma delas, no aplicativo como um todo. Microsoft garante pelo menos 99,9 por cento de disponibilidade para a maioria dos serviços, mas isso significa que cada serviço adicional do qual um aplicativo depende potencialmente reduz, em 0,1 por cento, a disponibilidade geral de SLA no seu sistema.
- **Crie tarefas e mensagens para que sejam idempotentes (possam ser repetidas com segurança), sempre que for possível**, para que as solicitações duplicadas não causem problemas. Por exemplo, um serviço pode agir como um consumidor que processa mensagens enviadas como solicitações por outras partes do sistema, as quais agem como produtores. Se o consumidor falha após processar a mensagem, mas antes de confirmar que esta foi processada, um produtor pode enviar uma solicitação de repetição que pode ser então processada por outra instância do consumidor. Por esse motivo, os consumidores e as operações que eles realizam devem ser idempotentes, de modo que repetir uma operação executada anteriormente não torne inválidos os resultados. Isso pode significar detecção duplicada de mensagens, ou garantir a consistência usando uma abordagem otimista para tratar dos conflitos.
- **Use um agente de mensagem que implemente alta disponibilidade para transações críticas.** Muitos cenários para iniciar tarefas ou acessar serviços remotos usam mensagens para passar instruções entre o aplicativo e o serviço de destino. Para melhor desempenho, o aplicativo deve ser capaz de enviar a mensagem e, em seguida, retornar para processar mais solicitações sem a necessidade de aguardar uma resposta. Para garantir a entrega de mensagens, o sistema de mensagens deve oferecer alta disponibilidade. Filas de Mensagens do Barramento de Serviço implementam a semântica _pelo menos uma vez_. Isso significa que cada mensagem publicada em uma fila não será perdida, embora possa ocorrer entrega de cópias duplicadas em determinadas circunstâncias. Se o processamento de mensagens for idempotente (consulte o item anterior), a repetição na entrega não deverá ser um problema.
- **Projete os aplicativos para degradarem normalmente o processamento** ao atingirem os limites do recurso, e realize a ação apropriada para minimizar o impacto para o usuário. Em alguns casos, a carga no aplicativo pode exceder a capacidade de uma ou mais partes, causando disponibilidade reduzida e conexões com falha. O dimensionamento pode ajudar a minimizar esse problema, mas ele pode atingir um limite imposto por outros fatores como disponibilidade de recursos ou custo. Projete o aplicativo para que nessa situação ele possa, de modo automático, degradar normalmente o processamento. Por exemplo, em um sistema de comércio eletrônico, se o subsistema de processamento de pedidos estiver sobrecarregado (ou se chegou até mesmo a falhar completamente), ele poderá ser desabilitado temporariamente, e as outras funcionalidades (como procurar no catálogo de produtos) continuarão funcionando. Pode ser apropriado adiar solicitações a um subsistema com falha permitindo ainda, por exemplo, que os clientes enviem pedidos, mas salvando-os para processamento posterior, quando o subsistema de pedidos estiver disponível novamente.
- **Tratar eventos rápidos de intermitência normalmente.** A maioria dos aplicativos precisa lidar com cargas de trabalho diferentes ao longo do tempo, como picos nos primeiros horários da manhã em um aplicativo de negócios ou quando um novo produto é lançado em um site de comércio eletrônico. O dimensionamento automático pode ajudar a lidar com a carga, mas pode levar algum tempo para instâncias adicionais ficarem online e tratarem das solicitações. Evite que picos de atividade repentinos e inesperados sobrecarreguem o aplicativo: projete-o de modo que coloque em fila as solicitações para os serviços que usa e diminua normalmente o processamento quando as filas estiverem próximas da capacidade total. Verifique se há desempenho e capacidade disponível suficientes sob condições sem intermitência para esvaziar as filas e tratar de solicitações pendentes. Para obter mais informações, consulte a [Padrão de Nivelamento de Carga Baseado em Fila](https://msdn.microsoft.com/library/dn589783.aspx).

## Implantação e manutenção

- **Implante várias instâncias de funções para cada serviço.** A Microsoft oferece garantias de disponibilidade para serviços que você cria e implanta, mas essas garantias somente serão válidas se você implantar pelo menos duas instâncias de cada função no serviço. Isso permite que uma função fique indisponível enquanto a outra permanece ativa. Isso é especialmente importante se você precisar implantar atualizações em um sistema ao vivo sem interromper as atividades dos clientes; é possível desativar e atualizar instâncias individualmente, enquanto as outras continuam online.
- **Aplicativos host em vários datacenters.** Embora isso seja extremamente improvável, é possível que todo um datacenter fique offline por meio de um evento, como um desastre natural ou falha de Internet. Aplicativos de negócios vitais devem ser hospedados em mais de um datacenter, para oferecer disponibilidade máxima. Isso pode reduzir a latência de usuários locais, além de oferecer outras oportunidades de flexibilidade ao atualizar aplicativos.
- **Automatizar e testar tarefas de implantação e manutenção.** Aplicativos distribuídos consistem em várias partes que devem trabalhar em conjunto. A implantação, portanto, deve ser automatizada usando mecanismos testados e aprovados como scripts e aplicativos de implantação. Eles podem atualizar e validar a configuração e automatizar o processo de implantação. Técnicas automatizadas também devem ser usadas para realizar atualizações de aplicativos inteiros ou partes de aplicativos. É fundamental testar todos esses processos integralmente, para garantir que não existirá tempo de inatividade adicional devido a erros. Todas as ferramentas de implantação devem ter restrições de segurança adequadas, para proteger o aplicativo implantado; defina e imponha políticas de implantação cuidadosamente e minimize a necessidade de intervenção humana.
- **Considere a possibilidade de usar os recursos de produção e preparo da plataforma** nos casos em que eles estão disponíveis. Por exemplo, usar os ambientes de preparo e produção dos Serviços de Nuvem do Azure permite alternar entre um aplicativo e outro instantaneamente, por meio de uma Permuta de VIP (permuta de endereço IP virtual). No entanto, se você preferir uma preparação local, ou preferir implantar versões diferentes do aplicativo simultaneamente e migrar gradualmente os usuários, você não poderá usar uma operação de Permuta de VIP.
- **Aplique as alterações de configuração sem reciclar** a instância quando possível. Em muitos casos, as definições de configuração para um aplicativo ou serviço do Azure podem ser alteradas sem exigir que a função seja reiniciada. A função expõe eventos que podem ser processados para detectar alterações de configuração e aplicá-las a componentes do aplicativo. No entanto, algumas alterações nas configurações da plataforma principal exigem a reinicialização de uma função. Ao criar serviços e componentes, maximize a disponibilidade e minimize o tempo de inatividade projetando-os para aceitar alterações na configuração sem a necessidade de reiniciar o aplicativo como um todo.
- **Use domínios de atualização para o tempo de inatividade zero durante as atualizações.** Unidades de computação do Azure, como funções de trabalho e da Web, são alocadas para domínios de atualização. Os domínios de atualização agrupam instâncias de função juntando-as de modo que, quando ocorre uma atualização sem interrupção, as funções no domínio de atualização são interrompidas, atualizadas e reiniciadas uma por vez. Isso minimiza o impacto na disponibilidade do aplicativo. Você pode especificar quantos domínios de atualização devem ser criados para um serviço quando o serviço é implantado.

	> [AZURE.NOTE] Funções também são distribuídas entre domínios de falha, cada um dos quais é razoavelmente independente de outros domínios de falha em termos de disponibilização de rack do servidor, energia e resfriamento, para minimizar a possibilidade de uma falha que afete todas as instâncias de função. Essa distribuição ocorre automaticamente e você não pode controlá-la.

- **Configure conjuntos de disponibilidade para máquinas virtuais do Azure.** A colocação de duas ou mais máquinas virtuais no mesmo conjunto de disponibilidade garante que essas máquinas virtuais não serão implantadas no mesmo domínio de falha. Para maximizar a disponibilidade, você deve criar várias instâncias de cada máquina virtual essencial usada pelo seu sistema e colocar essas instâncias no mesmo conjunto de disponibilidade. Se você estiver executando várias máquinas virtuais que servem para propósitos diferentes, crie um conjunto de disponibilidade para cada máquina virtual. Adicione instâncias de cada máquina virtual a cada conjunto de disponibilidade. Por exemplo, se você tiver criado máquinas virtuais separadas para atuarem como um servidor Web e um servidor de relatórios, crie um conjunto de disponibilidade para o servidor Web e outro conjunto de disponibilidade para o servidor de relatórios. Adicione instâncias da máquina de virtual do servidor Web ao conjunto de disponibilidade do servidor Web, e adicione instâncias da máquina virtual do servidor de relatórios ao conjunto de disponibilidade do servidor de relatórios.

## Gerenciamento de dados

- **Tire proveito da replicação de dados** tanto por meio da redundância local quanto da geográfica. Os dados no armazenamento do Azure são replicados automaticamente para proteção contra perda em caso de falha de infraestrutura, e alguns aspectos dessa replicação podem ser configurados. Por exemplo, cópias de dados somente leitura podem ser replicadas em mais de uma região geográfica (mencionado como armazenamento por redundância geográfica com acesso de leitura, ou RA-GRS). Observe que o uso de RA-GRS gerará cobranças adicionais. Para obter detalhes, confira [Preços de Armazenamento do Azure](https://azure.microsoft.com/pricing/details/storage/).
- **Use simultaneidade otimista e consistência eventual** sempre que possível. Transações que impedem o acesso a recursos por meio de bloqueio (simultaneidade pessimista) podem causar baixo desempenho e reduzir consideravelmente a disponibilidade. Esses problemas podem se tornar especialmente críticos em sistemas distribuídos. Em muitos casos, um design cuidadoso e técnicas como particionamento podem minimizar a possibilidade de ocorrência de atualizações conflitantes. Quando os dados forem replicados, ou lidos a partir de um repositório atualizado separadamente, serão consistentes apenas eventualmente. Mas as vantagens normalmente compensam o impacto na disponibilidade do uso de transações, a fim de garantir consistência imediata.
- **Utilize backup periódico e restauração pontual**, certificando-se de que ele atende o RPO (objetivo de ponto de recuperação). Faça regularmente e automaticamente o backup de dados que não são preservados em outro local; além disso, verifique se é possível restaurar de modo confiável tanto os dados quanto o aplicativo em si caso uma falha ocorra. A replicação de dados não é um recurso de backup, porque erros e inconsistências apresentadas por meio de operações mal-intencionadas, erros ou falhas serão replicadas em todos os repositórios. O processo de backup deve ser seguro, para proteger os dados em trânsito e em armazenamento. Bancos de dados ou partes de um repositório de dados podem geralmente ser recuperados para seu estado em um ponto anterior no tempo, usando logs de transação. O Microsoft Azure fornece um recurso de backup para dados armazenados no Banco de Dados SQL do Azure. Os dados são exportados para um pacote de backup no armazenamento de blobs do Azure e podem ser baixados para um espaço local seguro para armazenamento.
- **Habilite a opção de alta disponibilidade para manter uma cópia secundária de um Cache Redis do Azure.** Ao usar o Cache Redis do Azure, escolha a opção standard para manter uma cópia secundária do conteúdo. Para saber mais, confira [Criar um cache no Cache Redis do Azure](https://msdn.microsoft.com/library/dn690516.aspx).

## Erros e falhas

- **Introduza o conceito de um tempo limite.** Serviços e recursos podem tornar-se indisponíveis, fazendo com que determinadas solicitações falhem. Certifique-se de que os tempos limite aplicados sejam apropriados a cada serviço ou recurso, bem como ao cliente que o acessa. (Em alguns casos, talvez seja apropriado permitir um tempo limite maior para uma instância específica de um cliente, dependendo do contexto e de outras ações que o cliente esteja realizando.) Um tempo limite muito curto pode causar uma quantidade excessiva de operações de nova tentativa para serviços e recursos com uma latência considerável. Tempos limite muito longos pode causar um bloqueio se uma grande quantidade de solicitações for enfileirada, aguardando a resposta de um serviço ou recurso.
- **Repita operações com falha causadas por falhas transitórias.** Crie uma estratégia de repetição para acessar todos os serviços e recursos nos casos em que eles não oferecem suporte inerente a repetição automática de conexão. Use uma estratégia que inclui um atraso cada vez maior entre as repetições à medida que o número de falhas aumenta, a fim de evitar a sobrecarga do recurso e permitir que ele se recupere normalmente e processe as solicitações em fila. Repetições contínuas com atrasos muito curtos provavelmente agravarão o problema.
- **Pare de enviar solicitações para evitar falhas em cascata**, quando os serviços remotos não estiverem disponíveis. Pode haver situações nas quais falhas transitórias ou de outro tipo, que variam quanto à severidade desde uma perda parcial de conectividade até falha total de um serviço, demoram muito mais que o esperado para retornar ao normal. Além disso, se um serviço estiver muito ocupado, uma falha em uma parte do sistema pode levar a falhas em cascata, além de resultar em muitas operações ficando bloqueadas e ocupando, simultaneamente, recursos críticos do sistema, como memória, threads e conexões de banco de dados. Em vez de repetir continuamente uma operação com pouca probabilidade de êxito, o aplicativo deve aceitar rapidamente que a operação falhou e lidar normalmente com essa falha. Você pode usar o padrão de disjuntor para rejeitar as solicitações para operações específicas por períodos definidos. Para obter mais detalhes, confira [Circuit Breaker Pattern](https://msdn.microsoft.com/library/dn589784.aspx).
- **Redija ou retorne para vários componentes** para reduzir o impacto de um serviço específico estar offline ou indisponível. Crie aplicativos para tirar proveito de múltiplas instâncias sem afetar a operação e as conexões existentes, sempre que possível. Use múltiplas instâncias e distribua solicitações entre elas. Além disso, detecte instâncias com falha e evite enviar solicitações a elas, para maximizar a disponibilidade.
- **Retorne para um fluxo de trabalho ou um serviço diferente** sempre que possível. Por exemplo, se a gravação no Banco de Dados SQL falhar, armazene temporariamente os dados no armazenamento de blobs. Forneça um recurso para repetir as gravações feitas no armazenamento de blobs no Banco de Dados SQL quando o serviço ficar disponível. Em alguns casos, uma operação com falha pode ter uma ação alternativa que permite que o aplicativo continue a funcionar mesmo quando um componente ou serviço falha. Se possível, detecte as falhas e redirecione as solicitações para outros serviços que possam oferecer uma funcionalidade alternativa adequada, ou então para instâncias de backup ou redução de funcionalidade, que possam manter as operações principais enquanto o serviço primário estiver offline.

## Monitoramento e recuperação de desastres

- **Forneça instrumentação avançada para falhas prováveis e eventos de falha**, para reportar a situação à equipe de operações. Para falhas que provavelmente ocorrerão mas ainda não ocorreram, forneça dados suficientes para permitir que a equipe de operações determine a causa, atenue a situação e garanta que o sistema permaneça disponível. Para falhas que já ocorreram, o aplicativo deve retornar uma mensagem de erro apropriada para o usuário mas tentar continuar em execução, mesmo que com funcionalidade reduzida. Em todos os casos, o sistema de monitoramento deve capturar detalhes abrangentes para permitir que a equipe de operações efetue uma recuperação rápida e, se necessário, para que designers e desenvolvedores modifiquem o sistema para impedir que a situação ocorra novamente.
- **Monitore a integridade do sistema implementando funções de verificação.** A integridade e o desempenho de um aplicativo podem diminuir ao longo do tempo sem que essa mudança seja perceptível, até o aplicativo falhar. Implemente investigações ou verifique funções que são executadas regularmente de fora do aplicativo. Essas verificações podem ser tão simples quanto medir o tempo de resposta para o aplicativo como um todo, para partes individuais do aplicativo, para os serviços individuais que o aplicativo usa ou para componentes individuais. Funções de verificação podem executar processos para garantir que eles produzem resultados válidos, medir a latência e verificar a disponibilidade, além de extrair informações do sistema.
- **Tente regularmente todos os sistemas de failover e failback** para garantir que eles estejam disponíveis e funcionem conforme o esperado. As alterações aos sistemas e operações podem afetar as funções de failover e fallback, mas o impacto pode não ser detectado até que o sistema principal falhe ou fique sobrecarregado. Teste-o antes que ele seja exigido para compensar um problema em tempo real e em tempo de execução.
- **Teste os sistemas de monitoramento.** Sistemas automatizados de failover e fallback e visualização manual de desempenho e integridade do sistema pelo uso de painéis dependem, todos, do funcionamento correto da instrumentação e do monitoramento. Se esses elementos falharem, perderem informações essenciais ou relatarem dados imprecisos, um operador poderá deixar de perceber que o sistema não está íntegro ou que está falhando.
- **Acompanhe o progresso de fluxos de trabalho de longa execução** e tente novamente em caso de falha. Fluxos de trabalho de longa execução geralmente são compostos de várias etapas. Certifique-se de que cada etapa seja independente e possa ser repetida para minimizar a chance de que todo o fluxo de trabalho precise ser revertido, ou que várias transações de compensação precisem ser executadas. Monitore e gerencie o progresso de fluxos de trabalho de longa duração implementando um padrão como o [Scheduler Agent Supervisor Pattern](https://msdn.microsoft.com/library/dn589780.aspx).
- **Planeje-se para a eventualidade de uma recuperação de desastre.** Certifique-se de que haja um plano documentado, aceito e totalmente testado para a recuperação de qualquer tipo de falha que possa tornar todo o sistema principal ou parte dele indisponível. Teste os procedimentos regularmente e certifique-se de que toda a equipe de operações está familiarizada com o processo.

<!---HONumber=AcomDC_0406_2016-->